<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMU Data</title>
</head>
<body>
    <h2>IMUデータ送信</h2>
    <button onclick="start()">送信開始</button>

    <script>
        const SERVER_URL = "https://f19a-240b-253-ec00-9300-8005-524b-637b-42d0.ngrok-free.app/api/update";
        const TOKEN = "cansat";

        function start() {
            let lastSendTime = 0;
            const SEND_INTERVAL = 1000;
            window.addEventListener("devicemotion", (event) => {
                const acc = event.accelerationIncludingGravity;
                const gyro = event.rotationRate;

                const currentTime = Date.now();

                if (currentTime - lastSendTime >= SEND_INTERVAL) {

                    const payloads = [
                        {
                            token: TOKEN,
                            type: "ACC",
                            name: "phone",
                            data: { x: acc.x, y: acc.y, z: acc.z }
                        },
                        {
                            token: TOKEN,
                            type: "GYR",
                            name: "phone",
                            data: { x: gyro.alpha, y: gyro.beta, z: gyro.gamma }
                        }
                    ];

                    payloads.forEach(payload => {
                        fetch(SERVER_URL, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload)
                        }).catch(console.error);
                    });
                }
            });

            console.log("IMUデータ送信開始");
        }
    </script>
</body>
</html>
